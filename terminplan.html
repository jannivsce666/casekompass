<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Terminplan – Erstgespräch vereinbaren | casekompass.de</title>
    <meta
      name="description"
      content="Termin anfragen: Wunschtermin auswählen und Erstgespräch (telefonisch/online) anfragen."
    />
    <link rel="canonical" href="https://casekompass.de/terminplan.html" />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="icon" href="/images/logo.png" type="image/png" />
    <meta property="og:site_name" content="casekompass.de" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Terminplan – Erstgespräch vereinbaren | casekompass.de" />
    <meta
      property="og:description"
      content="Wunschtermin auswählen und Erstgespräch (telefonisch/online) anfragen."
    />
    <meta property="og:url" content="https://casekompass.de/terminplan.html" />
    <meta property="og:image" content="https://casekompass.de/images/logo.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Terminplan – Erstgespräch vereinbaren | casekompass.de" />
    <meta
      name="twitter:description"
      content="Wunschtermin auswählen und Erstgespräch (telefonisch/online) anfragen."
    />
    <meta name="twitter:image" content="https://casekompass.de/images/logo.png" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles.css?v=20260107-1" />
    <script defer src="/cart.js"></script>
    <script defer src="/effects.js"></script>
    <script type="module" src="/firebase.js"></script>
  </head>
  <body>
    <svg class="sprite-sheet" aria-hidden="true" focusable="false">
      <symbol id="i-cart" viewBox="0 0 24 24">
        <path d="M6 6h15l-2 9H7L6 6Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
        <path d="M6 6L5 3H2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M9 20a1 1 0 1 0 0 .01ZM17 20a1 1 0 1 0 0 .01Z" fill="none" stroke="currentColor" stroke-width="2" />
      </symbol>
      <symbol id="i-calendar" viewBox="0 0 24 24">
        <path d="M7 3v3M17 3v3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        <path d="M4 7h16v14H4V7Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
        <path d="M8 11h4M8 15h8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </symbol>
      <symbol id="i-message" viewBox="0 0 24 24">
        <path d="M21 12a8 8 0 0 1-8 8H7l-4 2l1.5-4.5A8 8 0 1 1 21 12Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
        <path d="M8 12h8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </symbol>
      <symbol id="i-mail" viewBox="0 0 24 24">
        <path d="M4 6h16v12H4V6Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
        <path d="M4 7l8 6l8-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
      </symbol>
      <symbol id="i-user" viewBox="0 0 24 24">
        <path d="M12 12a4 4 0 1 0-4-4a4 4 0 0 0 4 4Z" fill="none" stroke="currentColor" stroke-width="2" />
        <path d="M4 20a8 8 0 0 1 16 0" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </symbol>
    </svg>

    <header class="site-header">
      <div class="container header-inner">
        <a class="brand" href="/#top" aria-label="Startseite">
          <span class="brand-mark" aria-hidden="true"></span>
          <span class="brand-name">casekompass.de</span>
        </a>

        <nav class="nav" aria-label="Navigation" data-nav>
          <button class="nav-toggle" type="button" aria-label="Menü" aria-expanded="false" data-nav-toggle>
            <span class="nav-toggle-lines" aria-hidden="true"></span>
          </button>

          <div class="nav-links" data-nav-links>
            <a class="nav-link" href="/">Start</a>
            <a class="nav-link" href="/#leistungen">Leistungen</a>
            <a class="nav-link" href="/shop.html">Shop</a>
            <a class="nav-link" href="/terminplan.html">Termin</a>
            <a class="nav-link" href="/kontakt.html">Kontakt</a>
          </div>

          <a class="nav-link nav-profile" href="/profil.html" aria-label="Profil">
            <span class="nav-avatar" data-nav-avatar data-initials="?" aria-hidden="true"></span>
          </a>

          <a class="nav-link nav-cart" href="/warenkorb.html" aria-label="Warenkorb">
            <svg class="nav-cart-ico" aria-hidden="true"><use href="#i-cart"></use></svg>
            <span class="cart-count" data-cart-count aria-hidden="true"></span>
          </a>
        </nav>
      </div>
    </header>

    <main id="top" class="container">
      <section class="hero hero--compact" aria-label="Terminplan">
        <div class="hero-bg" aria-hidden="true"></div>
        <div class="hero-bg-overlay" aria-hidden="true"></div>
        <div class="hero-inner hero-inner--single">
          <div class="hero-copy reveal reveal--1">
            <p class="pill">Terminplan</p>
            <h1>
              Erstgespräch anfragen –
              <span class="accent">Wunschtermin auswählen</span>
            </h1>
            <p class="lead">
              Wählen Sie einen passenden Termin aus und senden Sie die Anfrage ab. Sie erhalten anschließend eine Bestätigung
              oder einen Alternativvorschlag per E‑Mail.
            </p>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="section-panel">
          <div class="section-head">
            <h2>Termin anfragen</h2>
            <p>
              Die folgenden Termine sind Vorschläge. Bei Bedarf schlage ich Alternativen vor.
            </p>
          </div>

          <div class="contact">
            <div class="contact-card panel">
              <h3 class="panel-title">
                <span class="ico-wrap" aria-hidden="true"><svg class="ico"><use href="#i-calendar"></use></svg></span>
                <span>Ablauf</span>
              </h3>
              <p>
                <strong>Dauer:</strong> 30 Minuten (telefonisch oder online)
              </p>
              <p>
                <strong>Hinweis:</strong> Bitte keine sensiblen Gesundheitsdaten über das Formular.
              </p>
              <p class="small">
                Alternativ: <a href="/kontakt.html">Kontaktformular</a> oder E‑Mail an <a href="mailto:casekompass@gmx.de">casekompass@gmx.de</a>.
              </p>
            </div>

            <form
              id="appointment-form"
              class="contact-form panel"
              method="post"
              action="https://api.web3forms.com/submit"
              aria-label="Terminanfrage"
            >
              <div class="panel-head">
                <div class="panel-head-left">
                  <span class="ico-wrap" aria-hidden="true"><svg class="ico"><use href="#i-message"></use></svg></span>
                  <h3 class="panel-title-text">Terminanfrage</h3>
                </div>
                <p class="panel-head-note">Antwort in der Regel innerhalb von 24–48 Stunden.</p>
              </div>

              <div class="form-group" aria-label="Termin auswählen">
                <label>
                  <span>Wunschtermin</span>
                  <select name="wunschtermin" id="slot-select" required aria-label="Wunschtermin auswählen">
                    <option value="">Bitte auswählen …</option>
                  </select>
                </label>

                <div class="cards" id="slot-suggestions" aria-label="Terminvorschläge" style="margin-top: 14px;"></div>
              </div>

              <fieldset class="form-group" aria-label="Art des Gesprächs">
                <legend>Gespräch</legend>
                <div class="option-list" role="radiogroup" aria-label="Gespräch">
                  <label class="option">
                    <input type="radio" name="gespraech" value="telefon" checked />
                    <span>Telefon</span>
                  </label>
                  <label class="option">
                    <input type="radio" name="gespraech" value="video" />
                    <span>Video/Online</span>
                  </label>
                </div>
              </fieldset>

              <label>
                <span>Name</span>
                <input name="name" type="text" placeholder="Max Mustermann" autocomplete="name" required />
              </label>

              <label>
                <span>E‑Mail</span>
                <input name="email" type="email" placeholder="max@example.com" autocomplete="email" required />
              </label>

              <label>
                <span>Telefon (optional)</span>
                <input name="telefon" type="tel" placeholder="0152 …" autocomplete="tel" />
              </label>

              <label class="sr-only" aria-hidden="true">
                <span>Firma</span>
                <input name="company" type="text" tabindex="-1" autocomplete="off" />
              </label>

              <label>
                <span>Kurzbeschreibung (optional)</span>
                <textarea
                  name="nachricht"
                  rows="5"
                  placeholder="Kurz: worum geht es? (ohne sensible Gesundheitsdaten)"
                ></textarea>
              </label>

              <fieldset class="form-group" aria-label="Datenschutz">
                <legend>Datenschutz</legend>
                <div class="checklist" aria-label="Datenschutz">
                  <label class="option">
                    <input type="checkbox" name="privacy" id="privacy" required />
                    <span>Ich habe die <a href="/datenschutz.html" target="_blank" rel="noopener">Datenschutzerklärung</a> gelesen und stimme zu.</span>
                  </label>
                </div>
              </fieldset>

              <p id="appointment-status" class="small" role="status" aria-live="polite" style="display: none; margin: 10px 0 0;"></p>

              <button class="btn btn-primary" type="submit">Terminanfrage senden</button>
            </form>
          </div>
        </div>
      </section>
    </main>

    <div class="loading-overlay" id="loading-overlay" aria-live="polite" aria-atomic="true" role="status">
      <div class="loading-box panel">
        <div class="loading-spinner" aria-hidden="true"></div>
        <h3 class="panel-title" style="justify-content:center;">Anfrage wird gesendet …</h3>
        <p class="small" id="loading-text" style="margin-top: 10px;">Bitte einen Moment warten.</p>
      </div>
    </div>

    <footer class="footer">
      <div class="container footer-inner">
        <span>© <span id="y"></span> casekompass.de</span>
        <a href="/impressum.html">Impressum</a>
      </div>
      <script>
        document.getElementById("y").textContent = String(new Date().getFullYear());
        requestAnimationFrame(() => {
          document.documentElement.classList.add("is-loaded");
        });

        const slotSelect = document.getElementById("slot-select");
        const suggestionWrap = document.getElementById("slot-suggestions");

        function pad2(n) {
          return String(n).padStart(2, "0");
        }

        function formatLabel(dateObj) {
          const weekday = dateObj.toLocaleDateString("de-DE", { weekday: "short" });
          const day = pad2(dateObj.getDate());
          const month = pad2(dateObj.getMonth() + 1);
          const year = dateObj.getFullYear();
          const hours = pad2(dateObj.getHours());
          const minutes = pad2(dateObj.getMinutes());
          return `${weekday}, ${day}.${month}.${year} – ${hours}:${minutes}`;
        }

        function buildSlots() {
          const slots = [];
          const now = new Date();
          const start = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
          const times = [
            { h: 9, m: 0 },
            { h: 10, m: 0 },
            { h: 11, m: 0 },
            { h: 13, m: 0 },
            { h: 14, m: 0 },
            { h: 15, m: 0 },
            { h: 16, m: 0 },
          ];

          let daysAdded = 0;
          let cursor = new Date(start);

          while (daysAdded < 14) {
            const day = cursor.getDay();
            const isWeekend = day === 0 || day === 6;
            if (!isWeekend) {
              for (const t of times) {
                const d = new Date(cursor.getFullYear(), cursor.getMonth(), cursor.getDate(), t.h, t.m);
                slots.push(d);
              }
              daysAdded += 1;
            }
            cursor.setDate(cursor.getDate() + 1);
          }

          return slots;
        }

        function renderSlotOptions() {
          if (!slotSelect) return;

          const slots = buildSlots();
          for (const d of slots) {
            const value = d.toISOString();
            const label = formatLabel(d);

            const opt = document.createElement("option");
            opt.value = value;
            opt.textContent = label;
            slotSelect.appendChild(opt);
          }

          if (suggestionWrap) {
            const sample = slots.slice(0, 8);
            suggestionWrap.innerHTML = "";

            for (const d of sample) {
              const card = document.createElement("article");
              card.className = "card panel";

              const title = document.createElement("h3");
              title.className = "panel-title";
              const span = document.createElement("span");
              span.textContent = formatLabel(d);
              title.appendChild(span);

              const actions = document.createElement("div");
              actions.className = "hero-actions";
              actions.style.marginTop = "12px";

              const btn = document.createElement("button");
              btn.type = "button";
              btn.className = "btn btn-secondary";
              btn.textContent = "Diesen Termin wählen";
              btn.addEventListener("click", () => {
                slotSelect.value = d.toISOString();
                slotSelect.focus();
              });

              actions.appendChild(btn);
              card.appendChild(title);
              card.appendChild(actions);
              suggestionWrap.appendChild(card);
            }
          }
        }

        renderSlotOptions();

        const form = document.getElementById("appointment-form");
        const statusEl = document.getElementById("appointment-status");
        const overlay = document.getElementById("loading-overlay");
        const overlayText = document.getElementById("loading-text");
        const privacyEl = document.getElementById("privacy");

        function setLoading(isLoading) {
          document.body.classList.toggle("is-loading", Boolean(isLoading));
          if (overlay) overlay.style.display = isLoading ? "flex" : "none";
        }

        if (form && statusEl) {
          form.addEventListener("submit", async (e) => {
            e.preventDefault();

            statusEl.style.display = "none";
            statusEl.textContent = "";
            if (overlayText) overlayText.textContent = "Bitte einen Moment warten.";

            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn ? submitBtn.textContent : "";
            if (submitBtn) {
              submitBtn.textContent = "Senden…";
              submitBtn.disabled = true;
            }
            setLoading(true);

            try {
              if (privacyEl && !privacyEl.checked) {
                setLoading(false);
                statusEl.style.display = "block";
                statusEl.textContent = "Bitte Datenschutzerklärung bestätigen.";
                if (submitBtn) {
                  submitBtn.textContent = originalText;
                  submitBtn.disabled = false;
                }
                return;
              }

              const formData = new FormData(form);
              formData.append("access_key", "bf91ac2c-a7ec-45cd-aeb8-85eea76afcd2");
              formData.append("subject", "Terminanfrage – casekompass.de");

              if (slotSelect && slotSelect.value) {
                const selected = new Date(slotSelect.value);
                formData.append("wunschtermin_label", formatLabel(selected));
              }

              const response = await fetch("https://api.web3forms.com/submit", {
                method: "POST",
                body: formData,
              });

              const data = await response.json().catch(() => ({}));

              if (!response.ok || !data || data.success !== true) {
                setLoading(false);
                statusEl.style.display = "block";
                statusEl.textContent = (data && data.message) ? String(data.message) : "Senden fehlgeschlagen. Bitte versuchen Sie es erneut oder nehmen Sie direkt Kontakt auf.";
                if (submitBtn) {
                  submitBtn.textContent = originalText;
                  submitBtn.disabled = false;
                }
                return;
              }

              // Store to Realtime Database for the profile page (if logged in)
              try {
                const fb = window.CasekompassFirebase;
                const user = fb && fb.auth ? fb.auth.currentUser : null;
                if (fb && user) {
                  const profile = await fb.loadUserProfile(user.uid);
                  const okProfile = profile && profile.privacyConsent === true && profile.fullName && profile.phone && profile.street && profile.postalCode && profile.city;
                  if (!okProfile) throw new Error("profile_incomplete");

                  const selectedIso = slotSelect && slotSelect.value ? String(slotSelect.value) : "";
                  const selectedLabel = (selectedIso ? formatLabel(new Date(selectedIso)) : "");
                  const talkTypeEl = form.querySelector('input[name="gespraech"]:checked');
                  const talkType = talkTypeEl ? String(talkTypeEl.value) : "";
                  await fb.addUserAppointment(user.uid, {
                    slotIso: selectedIso,
                    slotLabel: selectedLabel,
                    type: talkType,
                    status: "requested",
                  });
                }
              } catch {
                // DB store is best-effort; do not block sending.
              }

              if (overlayText) overlayText.textContent = "Anfrage erfolgreich versendet. Weiterleitung …";
              form.reset();

              setTimeout(() => {
                window.location.href = "/#top";
              }, 1400);
            } catch {
              setLoading(false);
              statusEl.style.display = "block";
              statusEl.textContent = "Senden fehlgeschlagen. Bitte versuchen Sie es erneut oder nehmen Sie direkt Kontakt auf.";
              if (submitBtn) {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
              }
            }
          });
        }
      </script>
    </footer>
  </body>
</html>
